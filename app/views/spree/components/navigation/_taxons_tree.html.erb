<%
  # Props
  title = local_assigns.fetch(:title, nil)
  root = local_assigns.fetch(:root, nil)
  current = local_assigns.fetch(:current, nil)
  depth = local_assigns.fetch(:depth, 1)
  base_class = local_assigns.fetch(:base_class, nil)
  additional_links = local_assigns.fetch(:additional_links, nil)

  # Methods
  def tree(root_taxon, current_taxon, max_level = 1)
    return '' if max_level < 1 || root_taxon.children.empty?
    taxons = root_taxon.children.map do |taxon|
      css_class = (current_taxon && current_taxon.self_and_ancestors.include?(taxon)) ? 'current' : nil
      content_tag :li, class: css_class do
       link_to(taxon.name, seo_url(taxon)) +
         tree(taxon, current_taxon, max_level - 1)
      end
    end
    safe_join(taxons, "\n")
  end

  def prepend_additional_links(additional_links)
    links = additional_links.map do |additional_link|
      content_tag(:li, additional_link)
    end

    safe_join(links, "\n")
  end
%>

<% taxons_list = tree(root, current, depth) %>

<% if taxons_list.present? %>
  <%= content_tag :h6, title, class: "#{base_class}__title" if title %>
  <%= content_tag :ul, class: base_class do %>
    <%= prepend_additional_links(additional_links) if additional_links %>
    <%= taxons_list %>
  <% end %>
<% end %>
